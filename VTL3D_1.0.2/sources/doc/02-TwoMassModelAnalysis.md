# TwoMassModel 声门模型分析

本文档分析 `TwoMassModel` 类（主要基于 `TwoMassModel.cpp` 和 `TwoMassModel.h`）在 VocalTractLab3D 项目中的作用和功能。该模型是用于语音合成的经典声源模型之一。

## 概述

`TwoMassModel` 类实现了一个基于物理的**双质量声门模型**。该模型旨在模拟人声带在气流驱动下的振动行为，从而产生准周期的声门脉冲（glottal pulse）。这些脉冲是合成浊音（如元音）时的主要激励源。

其核心思想是将每侧声带简化为两个相互连接的质量块：一个"下质量块"和一个"上质量块"。这两个质量块通过模拟的弹簧和阻尼器相互作用，并对声门下（subglottal）和声门上（supraglottal）的气压差作出动态响应。

## 主要功能与特性

根据 `TwoMassModel.cpp` 的实现，该类的关键功能包括：

1.  **参数化控制 (Control Parameters)**:
    *   模型提供了一系列控制参数，允许用户或上层逻辑动态调整声源特性。这些参数通常包括：
        *   `f0`: 目标基频 (Hertz)。
        *   `Subglottal pressure`: 声门下压 (deciPascals)，驱动声带振动的主要能量来源。
        *   `Lower rest displacement`: 下质量块的静止位移或初始开口大小 (cm)。
        *   `Upper rest displacement`: 上质量块的静止位移或初始开口大小 (cm)。
        *   `Extra arytenoid area`: 杓状软骨间隙面积 (cm²)，模拟声门后部的漏气，影响声音的"气泡感"(breathiness)。
        *   `Damping factor`: 整体阻尼因子，影响振动的衰减快慢。

2.  **静态物理参数 (Static Parameters)**:
    *   这些参数定义了模型的内在物理属性，通常代表特定说话人声带的解剖和生物力学特性。一旦设定，一般在一次仿真中保持不变（除非切换"speaker"文件）。主要参数有：
        *   声带长度、上下质量块的静止厚度和质量。
        *   上下质量块各自的线性弹簧系数和非线性弹簧特性指数。
        *   上下质量块的阻尼比。
        *   声带闭合时的接触弹簧特性（刚度和非线性指数）。
        *   上下质量块之间的耦合弹簧系数。
        *   声带开始接触的临界宽度。
        *   声门的"固有基频"（Natural F0）以及基频随声带张力参数Q（Tension Q）的变化率。
        *   声门裂隙长度（Chink length），与杓状软骨间隙共同作用。

3.  **运动方程与时域仿真 (`incTime` 方法)**:
    *   `incTime` 是模型的核心动力学计算函数。它根据当前的控制参数、静态参数以及输入的声门上、中、下三处的压力值，通过数值积分（很可能是某种形式的欧拉法或更高级的积分器）求解一组耦合的二阶微分方程（代表两个质量块的运动），从而计算出在一个小的离散时间步长 (`timeIncrement_s`) 之后两个质量块的新位移。
    *   该方法精确地模拟了驱动声带运动的各种力：
        *   **气动力**: 由声门上下压力差作用在质量块表面产生。
        *   **机械力**: 包括质量块自身的惯性力、线性与非线性弹簧产生的恢复力、阻尼力以及质量块之间通过耦合弹簧产生的相互作用力。
        *   **接触力**: 当质量块位移小于临界宽度时，模拟声带碰撞产生的非常硬的接触力。
    *   模型会考虑声带张力参数 `Q` 对质量、厚度、弹簧系数等的动态影响，`Q` 本身又与目标基频 `f0` 相关联。

4.  **瞬时几何计算 (`calcGeometry`, `getLengthAndThickness` 方法)**:
    *   `calcGeometry`: 在每个时间步，根据 `incTime` 计算出的两个质量块的瞬时相对位移，结合静止位移和杓状软骨间隙，计算出当前的上下声门开口面积 (`CURRENT_AREA_1`, `CURRENT_AREA_2`)、有效声带长度和厚度等几何参数。
    *   `getLengthAndThickness`: 根据当前的声带张力参数 `Q`，计算声带的有效振动长度和上下质量块的有效厚度。声带拉紧时，长度增加，厚度减小。

5.  **声门面积输出 (`getTubeData` 方法)**:
    *   提供标准接口，输出当前计算得到的瞬时上下声门面积和对应的厚度（管段长度）。这些数据是后续声道模型（如 `TdsModel` 或 `TlModel`）计算声门处声学激励所必需的输入。

6.  **作为 `Glottis` 派生类**: `TwoMassModel` 通常继承自一个通用的抽象基类 `Glottis`，并实现了其定义的标准接口（如初始化、推进时间步、计算几何、获取输出等）。这使得程序可以方便地在多种声门模型之间切换。

## 与 `Acoustic3dSimulation` 的关系

`TwoMassModel` 本身并不直接参与 `Acoustic3dSimulation` 进行的声道传递函数计算。它们的关系是**声源-滤波器模型**中的两部分：

*   **`Acoustic3dSimulation` (滤波器)**: 计算声道的声学特性，即给定声源后声音如何通过声道传播和辐射，可以看作是一个复杂的时变滤波器。
*   **`TwoMassModel` (声源)**: 模拟声带振动，产生激励信号（通常是声门体积流速或其微分）。

在完整的语音合成流程中：
1.  `TwoMassModel` (或其他选定的 `Glottis` 模型) 在每个采样时刻计算出瞬时的声门气流。
2.  这个声门气流信号作为激励源。
3.  `Acoustic3dSimulation` 计算出当前声道形状下的传递函数（或脉冲响应）。
4.  激励源信号与声道传递函数（或脉冲响应）进行卷积（或在频域相乘），最终产生输出的语音信号。

因此，即使主要关注点是 `Acoustic3dSimulation`，一个有效的声源模型（如 `TwoMassModel`）对于从该仿真结果中合成出可听的语音也是至关重要的。

## 结论

`TwoMassModel` 是 VocalTractLab3D 中一个基于物理的、参数可控的声门振动模型，用于生成合成语音所需的核心声源激励。它是实现高质量浊音合成的关键组件，与声道模型（无论是 `TlModel`、`TdsModel` 还是 `Acoustic3dSimulation`）协同工作，共同完成从参数到声音的转换。

对于一个以 `Acoustic3dSimulation` 为核心的简化系统，如果仍然需要合成和播放声音，那么 `TwoMassModel` (或其他声门模型) 及其基类 `Glottis` 的功能是需要保留的。 